<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="payment">

    <insert id="postPayment">
        INSERT INTO payments
            (
                "paymentId"             ,
                "purchaseId"            ,
                "amount"                ,
                "currency"              ,
                "shopId"                ,
                "account"               ,
                "loyaltyType"           ,
                "paidPoint"             ,
                "paidToken"             ,
                "paidValue"             ,
                "feePoint"              ,
                "feeToken"              ,
                "feeValue"              ,
                "totalPoint"            ,
                "totalToken"            ,
                "totalValue"            ,
                "paymentStatus"         ,
                "openNewTimestamp"      ,
                "closeNewTimestamp"      ,
                "openCancelTimestamp"   ,
                "closeCancelTimestamp"
            )
        VALUES
            (
                #{paymentId}        ,
                #{purchaseId}       ,
                #{amount}           ,
                #{currency}         ,
                #{shopId}           ,
                #{account}          ,
                ${loyaltyType}      ,
                #{paidPoint}        ,
                #{paidToken}        ,
                #{paidValue}        ,
                #{feePoint}         ,
                #{feeToken}         ,
                #{feeValue}         ,
                #{totalPoint}       ,
                #{totalToken}       ,
                #{totalValue}       ,
                ${paymentStatus}    ,
                ${openNewTimestamp} ,
                ${closeNewTimestamp} ,
                ${openCancelTimestamp},
                ${closeCancelTimestamp}
            )
        ON CONFLICT ("paymentId")  DO NOTHING;
    </insert>

    <select id="getPayment">
        SELECT * FROM payments WHERE "paymentId" = #{paymentId};
    </select>


    <update id="updatePayment">
        UPDATE payments
        SET
            "paidPoint"             = #{paidPoint},
            "paidToken"             = #{paidToken},
            "paidValue"             = #{paidValue},
            "feePoint"              = #{feePoint},
            "feeToken"              = #{feeToken},
            "feeValue"              = #{feeValue},
            "totalPoint"            = #{totalPoint},
            "totalToken"            = #{totalToken},
            "totalValue"            = #{totalValue},
            "paymentStatus"         = ${paymentStatus},
            "openNewTimestamp"      = ${openNewTimestamp},
            "closeNewTimestamp"     = ${closeNewTimestamp},
            "openCancelTimestamp"   = ${openCancelTimestamp},
            "closeCancelTimestamp"  = ${closeCancelTimestamp}
        WHERE "paymentId" = #{paymentId}
    </update>

    <update id="updateStatus">
        UPDATE payments
        SET
            "paymentStatus" = ${paymentStatus}
        WHERE "paymentId" = #{paymentId}
    </update>

    <update id="updateCloseNewTimestamp">
        UPDATE payments
        SET
            "closeNewTimestamp" = ${value}
        WHERE "paymentId" = #{paymentId}
    </update>

    <update id="updateOpenCancelTimestamp">
        UPDATE payments
        SET
            "openCancelTimestamp" = ${value}
        WHERE "paymentId" = #{paymentId}
    </update>

    <update id="updateCloseCancelTimestamp">
        UPDATE payments
        SET
            "closeCancelTimestamp" = ${value}
        WHERE "paymentId" = #{paymentId}
    </update>

    <select id="getPaymentsForType">
        SELECT * FROM payments WHERE "paymentStatus" = ${paymentStatus};
    </select>

    <select id="getDelayedNewPayments">
        SELECT * FROM payments WHERE "paymentStatus" in (1,2,3,4);
    </select>
    <select id="getDelayedCancelPayments">
        SELECT * FROM payments WHERE "paymentStatus" in (7,8,9,10);
    </select>
</mapper>
