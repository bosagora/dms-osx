# DMS Relay

## 1. 개요

사용자는 키오스크 구매를 통해 마일리지를 적립받는다.  
사용자는 적립한 마일리지를 사용하여 상품으로 교환할 수 있다.  
사용자가 적립한 마일리지를 사용할 때 스마트컨트랙트를 호출하여야 한다. 이 때 트랜잭션 수수료로 BOA가 필요하다.  
따라서 사용성을 높이기 위해 수수료 대납해주는 중계서비스가 필요했다. 이것을 이 서비스에서 제공한다.

## 2. 기능

### 2.1. 트랜잭션을 중계하는 기능

-   전화번호로 적립한 임시 마일리지를 사용가능 마일리지로 전환하는 기능
-   사용자가 적립할 마일리지를 토큰으로 변경하는 기능
-   상점정보를 추가하는 기능
-   상점의 정보를 변경하는 기능
-   상점의 인출 신청을 요청기능
-   상점이 요청한 인출 신청에 대한 완료되었음을 승인기능

### 2.2. 키오스크의 마일리지 결제정보를 중계하는 기능

-   마일리지를 사용하기 위해서는 중간에 사용자의 서명이 필수적으로 필요하다.
-   사용자는 마일리지를 사용하기 위해 키오스크에 사용자의 월렛의 주소를 입력한다. (사용자용 앱의 QR코드 이용)
-   키오스크는 결제정보를 DMS-Relay로 전달한다.
-   DMS-Relay는 사용자용 앱에 푸쉬메세지를 전송한다.
-   사용자용 앱은 결제정보를 DMS-Relay에서 다운받은 다음 서명한 후 DMS-Relay에 전송한다.
-   DMS-Relay는 사용자의 서명정보와 결제정보를 가지고 마일리지 원장 스마트컨트랙트를 호출한다.
-   결과를 키오스크에 전달한다.
-   이 과정에서 사용자는 결제를 승인 또는 거부할 수 있다.
-   결제뿐만 아니라 결제를 취소하는 기능도 포함되어 있다.

### 2.3. 마일리지 원장 스마트컨트랙트의 조회함수를 호출하여 정보를 제공하는 기능

-   잔고조회
-   상점의 기본 정보 조회
-   상점의 정산 정보 조회
-   상점의 인출 정보 조회

## 3. 마일리지를 사용한 결제 프로세스

[마일리지를 사용한 결제 프로세스 - 시퀀스 다이어그램](docs%2Floyalty-payment-sequence-diagram.md)  
[마일리지를 사용한 결제 프로세스 - 엔드포인트](docs%2Floyalty-payment-endpoint.md)
